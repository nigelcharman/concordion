<html xmlns:concordion="http://www.concordion.org/2007/concordion">
<link href="../../../../concordion.css" rel="stylesheet" type="text/css" />
<body>

    <h1>Listeners</h1>

    <p>
       The execution of Concordion commands can be observed using <code>listeners</code>. Listeners have access to the HTML element with which the command is associated,
       and can modify the output HTML. 
    </p>

    <div class="example">

        <h3>Example</h3>
        
        <p>An <span concordion:execute="addLoggingExtension()">extension is installed</span> that listens to assertEquals, assertTrue, assertFalse and execute commands. When the following instrumentation:</p> 
<pre concordion:set="#result = process(#TEXT)">
&lt;p concordion:execute="#result=sqrt(#num)"&gt;The square root of &lt;span concordion:set="#num"&gt;4.0&lt;/span&gt; is &lt;span concordion:assertEquals="#result"&gt;2.0&lt;/span&gt;&lt;/p&gt;

&lt;p concordion:execute="#result=sqrt(#num)"&gt;The square root of &lt;span concordion:set="#num"&gt;16.0&lt;/span&gt; is &lt;span concordion:assertEquals="#result"&gt;3.0&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span concordion:set="#num"&gt;3&lt;/span&gt;
is &lt;span concordion:assertTrue="isPositive(#num)"&gt;is positive&lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;&lt;span concordion:set=&quot;#num&quot;&gt;-4&lt;/span&gt;
is &lt;span concordion:assertTrue=&quot;isPositive(#num)&quot;&gt;is positive&lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;&lt;span concordion:set="#num"&gt;-5&lt;/span&gt;
is &lt;span concordion:assertFalse="isPositive(#num)"&gt;is not positive&lt;/span&gt;
&lt;/p&gt;

&lt;p&gt;&lt;span concordion:set="#num"&gt;6&lt;/span&gt;
is &lt;span concordion:assertFalse="isPositive(#num)"&gt;is not positive&lt;/span&gt;
&lt;/p&gt;

</pre>

        <p>is run with a fixture that performs the arithmetical operations, the logged events are:
        </p>
        <table concordion:verifyRows="#event : getEventLog()">
        <tr><th concordion:assertEquals="#event">Event</th></tr>
        <tr><td>Set #num = '4.0'</td></tr>
        <tr><td>Execute 'The square root of 4.0 is 2.0'</td></tr>
        <tr><td>Success '2.0'</td></tr>
        <tr><td>Set #num = '16.0'</td></tr>
        <tr><td>Execute 'The square root of 16.0 is 3.0'</td></tr>
        <tr><td>Failure expected:'3.0' actual:'4.0'</td></tr>
        <tr><td>Set #num = '3'</td></tr>
        <tr><td>Success 'is positive'</td></tr>
        <tr><td>Set #num = '-4'</td></tr>
        <tr><td>Failure expected:'is positive' actual:'== false'</td></tr>
        <tr><td>Set #num = '-5'</td></tr>
        <tr><td>Success 'is not positive'</td></tr>
        <tr><td>Set #num = '6'</td></tr>
        <tr><td>Failure expected:'is not positive' actual:'== true'</td></tr>
        </table>

    </div>

    <h2>Other listeners</h2>

    <h3>Command Listeners</h3>
    <ul>
        <li><a concordion:run="concordion" href="ExecuteTableListener.html">Execute table listeners</a> are notified on each row when <a concordion:run="concordion" href="../../command/execute/ExecutingTables.html">executing tables</a></li>
        <li><a concordion:run="concordion" href="VerifyRowsListener.html">Verify row listeners</a> observe <a concordion:run="concordion" href="../../command/verifyRows/VerifyRows.html">verifyRows</a> commands</li>
        <li><code>Run listeners</code> are notified of the outcome of <a concordion:run="concordion" href="../../command/run/Run.html">run</a> commands (success, failure or ignored)</li>
        <li><code>Throwable caught listeners</code> are notified of any <code>throwables</code> that occur while processing a command, including <a concordion:run="concordion" href="../CustomCommand.html">custom commands</a>.</li>
        <li><a concordion:run="concordion" href="ExampleListener.html">Example listeners</a> observe the example command and are notified before and after each example is run</li> 
    </ul>

    <h3>Processing Listeners</h3>
    <ul>
        <li><code>Concordion build listeners</code> provide access to the <code>target</code> to allow resources to be written</li>
        <li><code>Document parsing listeners</code> provide access to the <code>document</code> prior to parsing</li>
        <li><code>Specification processing listeners</code> provide access to the <code>specification</code> before and after processing</li>
    </ul>

    <div class="example">

        <h3>Example</h3>
        
        <p>An <span concordion:execute="addProcessingExtension()">extension is installed</span> with a ConcordionBuildListener, DocumentParsingListener, SpecificationProcesssingListener and AssertEqualsListener. When the following instrumentation:</p> 
<pre concordion:set="#result = process(#TEXT)">
&lt;p&gt;The square root of &lt;span concordion:set="#num"&gt;16.0&lt;/span&gt; is &lt;span concordion:assertEquals="sqrt(#num)"&gt;4.0&lt;/span&gt;&lt;/p&gt;
</pre>

        <p>is run with a fixture that performs the arithmetical operations, the logged events are:
        </p>
        <table concordion:verifyRows="#event : getEventLog()">
        <tr><th concordion:assertEquals="#event">Event</th></tr>
        <tr><td>Concordion Built</td></tr>
        <tr><td>Before Parsing Document</td></tr>
        <tr><td>Before Processing [Resource: /testrig]</td></tr>
        <tr><td>Success '4.0'</td></tr>
        <tr><td>After Processing [Resource: /testrig]</td></tr>
        </table>

    </div>

    <div class="example" concordion:example="Example with examples">

        <h3>Example with concordion:example</h3>
        
        <p>An <span concordion:execute="addExampleProcessingExtension()">extension is installed</span> with a ConcordionBuildListener, DocumentParsingListener, SpecificationProcesssingListener, ExampleListener and AssertEqualsListener. When the following instrumentation:</p> 
<pre concordion:set="#result = process(#TEXT)">
&lt;div concordion:example="before"&gt;
&lt;/div&gt;

&lt;div concordion:example="example1"&gt;
&lt;p&gt;The square root of &lt;span concordion:set="#num"&gt;16.0&lt;/span&gt; is &lt;span concordion:assertEquals="sqrt(#num)"&gt;4.0&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div concordion:example="example2"&gt;
&lt;p&gt;The square root of &lt;span concordion:set="#num"&gt;9.0&lt;/span&gt; is &lt;span concordion:assertEquals="sqrt(#num)"&gt;3.0&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
</pre>

        <p>is run with a fixture that performs the arithmetical operations, the logged events are:
        </p>
        <table concordion:verifyRows="#event : getEventLog()">
        <tr><th concordion:assertEquals="#event">Event</th></tr>
        <tr><td>Concordion Built</td></tr>
        <tr><td>Before Parsing Document</td></tr>
        <tr><td>Before Processing [Resource: /testrig]</td></tr>
        <tr><td>Before example 'before'</td></tr>
        <tr><td>After example 'before'</td></tr>
        <tr><td>Before example 'example1'</td></tr>
        <tr><td>Success '4.0'</td></tr>
        <tr><td>After example 'example1'</td></tr>
        <tr><td>Before example 'before'</td></tr>
        <tr><td>After example 'before'</td></tr>
        <tr><td>Before example 'example2'</td></tr>
        <tr><td>Success '3.0'</td></tr>
        <tr><td>After example 'example2'</td></tr>
        <tr><td>After Processing [Resource: /testrig]</td></tr>
        </table>

    </div>

    <div class="example" concordion:example="Example with mixed examples">

        <h3>Example with mixture of concordion:example and anonymous example</h3>
        
        <p>An <span concordion:execute="addExampleProcessingExtension()">extension is installed</span> with a ConcordionBuildListener, DocumentParsingListener, SpecificationProcesssingListener, ExampleListener and AssertEqualsListener. When the following instrumentation:</p> 
<pre concordion:set="#result = process(#TEXT)">
&lt;div concordion:example="before"&gt;
&lt;/div&gt;

&lt;div concordion:example="example1"&gt;
&lt;p&gt;The square root of &lt;span concordion:set="#num"&gt;16.0&lt;/span&gt; is &lt;span concordion:assertEquals="sqrt(#num)"&gt;4.0&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;The square root of &lt;span concordion:set="#num"&gt;9.0&lt;/span&gt; is &lt;span concordion:assertEquals="sqrt(#num)"&gt;3.0&lt;/span&gt;&lt;/p&gt;
</pre>

        <p>is run with a fixture that performs the arithmetical operations, the logged events are:
        </p>
        <table concordion:verifyRows="#event : getEventLog()">
        <tr><th concordion:assertEquals="#event">Event</th></tr>
        <tr><td>Concordion Built</td></tr>
        <tr><td>Before Parsing Document</td></tr>
        <tr><td>Before Processing [Resource: /testrig]</td></tr>
        <tr><td>Before example 'before'</td></tr>
        <tr><td>After example 'before'</td></tr>
        <tr><td>Before example 'example1'</td></tr>
        <tr><td>Success '4.0'</td></tr>
        <tr><td>After example 'example1'</td></tr>
        <tr><td>Before example 'before'</td></tr>
        <tr><td>After example 'before'</td></tr>
        <tr><td>Success '3.0'</td></tr>
        <tr><td>After Processing [Resource: /testrig]</td></tr>
        </table>

    </div>

    <h2>Further Details</h2>

    <ul>
        <li>How are listeners <a concordion:run="concordion" href="../Extension.html">added to Concordion?</a></li>
    </ul>
</body>
</html>